document.addEventListener("DOMContentLoaded", () => {
if (window.__SEM_CLINICA__ === true) {
  console.warn("Painel bloqueado: clÃ­nica nÃ£o criada ainda");
  return;
}

  const inputLinkCliente = document.getElementById("linkClienteSalao");
  const btnCopiarCliente = document.getElementById("copiarLinkCliente");

  const inputTelefone = document.getElementById("telefoneCliente");
  const btnEnviar = document.getElementById("btnEnviarWhatsapp");

  // ðŸ”‘ SEMPRE vem do config (painel)
  const config = ConfigClinica.obter();

  if (!config || !config.clinica_id) {
    alert("ClÃ­nica nÃ£o configurada corretamente.");
    return;
  }

  const clinicaId = config.clinica_id;

  // =========================
  // LINK OFICIAL DO CLIENTE
  // =========================
  const BASE_URL = "https://app-estetica-seven.vercel.app";
  const linkCliente = `${BASE_URL}?c=${clinicaId}`;

  inputLinkCliente.value = linkCliente;

  // =========================
  // COPIAR LINK
  // =========================
  btnCopiarCliente.onclick = () => {
    navigator.clipboard.writeText(linkCliente);
    btnCopiarCliente.innerText = "Copiado âœ“";

    setTimeout(() => {
      btnCopiarCliente.innerText = "Copiar";
    }, 2000);
  };

  // =========================
  // ENVIAR POR WHATSAPP
  // =========================
  function limparTelefone(valor) {
    return valor.replace(/\D/g, "");
  }

  btnEnviar.onclick = () => {
    const telefone = limparTelefone(inputTelefone.value);

    if (telefone.length < 10) {
      alert("Digite um telefone vÃ¡lido com DDD");
      return;
    }

    const nomeClinica =
      config.identidade?.nome && config.identidade.nome !== ""
        ? config.identidade.nome
        : "nossa clÃ­nica";

    const mensagem =
`OlÃ¡ ðŸ˜Š

Aqui estÃ¡ o link para vocÃª agendar seu horÃ¡rio no *${nomeClinica}*:
${linkCliente}

Qualquer dÃºvida Ã© sÃ³ chamar ðŸ’œ`;

    const url = `https://wa.me/55${telefone}?text=${encodeURIComponent(mensagem)}`;
    window.open(url, "_blank");
  };

});
